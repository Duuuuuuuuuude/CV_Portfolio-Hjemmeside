apiVersion: apps/v1
kind: Deployment
metadata:
  name: koldstedev
  namespace: backend
spec:
  replicas: 1
  selector:
    matchLabels:
      app: koldstedev
  strategy:
    type: RollingUpdate
  template:
    metadata:
      labels:
        app: koldstedev
    spec:
      containers:
      - name: koldstedev
        # image: {{DOCKER_IMAGE_NAME}}:{{DOCKER_IMAGE_TAG}} # Placeholders. Will be replaced in the Azure pipeline.
        env:
        - name: ASPNETCORE_HTTP_PORTS
          value: "8800"
        - name: ASPNETCORE_HTTPS_PORTS
          value: "8800"
        ports:
        - containerPort: 8800
          name: http

        securityContext: # https://techcommunity.microsoft.com/t5/microsoft-developer-community/hardening-an-asp-net-container-running-on-kubernetes/ba-p/2542224
            runAsNonRoot: true
            runAsUser: 1000
            runAsGroup: 2000
            allowPrivilegeEscalation: false
            privileged: false
            readOnlyRootFilesystem: true
            capabilities:
                drop:
                - all
              
